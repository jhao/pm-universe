<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>æŠ€æœ¯äº¤æµä¼š Â· æ¡Œæ¸¸å¼ç©æ³•æ¼”ç¤º Demo</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "PingFang SC", "Microsoft YaHei", sans-serif;
      background: #f5f5f7;
      margin: 0;
      padding: 0;
      color: #333;
    }

    .container {
      max-width: 1100px;
      margin: 0 auto;
      padding: 24px 16px 40px;
    }

    h1, h2, h3 {
      margin: 0 0 12px;
    }

    h1 {
      font-size: 24px;
      text-align: center;
      margin-bottom: 16px;
    }

    .card {
      background: #fff;
      border-radius: 12px;
      padding: 16px 20px;
      margin-bottom: 16px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.04);
    }

    .card.highlight {
      border: 2px solid #007aff;
    }

    .section-title {
      font-size: 18px;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .badge {
      display: inline-block;
      font-size: 12px;
      padding: 2px 8px;
      border-radius: 999px;
      background: #eee;
      color: #555;
    }

    .badge-primary {
      background: #007aff22;
      color: #007aff;
    }

    .badge-secondary {
      background: #34c75922;
      color: #34c759;
    }

    .badge-danger {
      background: #ff3b3022;
      color: #ff3b30;
    }

    .steps {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 12px;
    }

    .step-pill {
      padding: 4px 10px;
      border-radius: 999px;
      background: #e5e5ea;
      font-size: 12px;
    }

    .step-pill.active {
      background: #007aff;
      color: #fff;
    }

    button {
      border-radius: 999px;
      border: none;
      padding: 8px 16px;
      font-size: 14px;
      cursor: pointer;
      background: #007aff;
      color: #fff;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    button.secondary {
      background: #e5e5ea;
      color: #333;
    }

    button:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }

    .btn-row {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-top: 8px;
    }

    textarea, input, select {
      border-radius: 8px;
      border: 1px solid #ddd;
      padding: 6px 10px;
      font-size: 14px;
      width: 100%;
      box-sizing: border-box;
    }

    textarea {
      min-height: 70px;
      resize: vertical;
    }

    label {
      font-size: 13px;
      color: #555;
      display: block;
      margin-bottom: 4px;
      margin-top: 6px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 8px;
      font-size: 13px;
    }

    th, td {
      border-bottom: 1px solid #eee;
      padding: 6px 4px;
      text-align: left;
      vertical-align: top;
    }

    th {
      background: #fafafa;
      font-weight: 600;
    }

    .role-tag {
      display: inline-block;
      border-radius: 999px;
      padding: 2px 8px;
      font-size: 12px;
    }

    .role-core {
      background: #ffcc0022;
      color: #b58200;
    }

    .role-main {
      background: #34c75922;
      color: #1d9040;
    }

    .role-observer {
      background: #e5e5ea;
      color: #555;
    }

    .skill-tag {
      display: inline-block;
      border-radius: 999px;
      padding: 2px 8px;
      margin: 1px 2px;
      font-size: 12px;
    }

    .skill-attack {
      background: #ff3b3022;
      color: #ff3b30;
    }

    .skill-support {
      background: #007aff22;
      color: #007aff;
    }

    .skill-chaos {
      background: #af52de22;
      color: #af52de;
    }

    .hint {
      font-size: 13px;
      color: #666;
      margin-top: 4px;
    }

    .guide-box {
      border-radius: 12px;
      background: #f2f2f7;
      padding: 10px 12px;
      font-size: 13px;
      margin-top: 4px;
    }

    .guide-title {
      font-weight: 600;
      margin-bottom: 4px;
    }

    .log-box {
      background: #000;
      color: #0f0;
      font-family: "SF Mono", "Menlo", monospace;
      border-radius: 8px;
      padding: 8px;
      font-size: 12px;
      max-height: 140px;
      overflow-y: auto;
    }

    .log-entry {
      margin-bottom: 2px;
    }

    ul {
      padding-left: 18px;
      margin: 4px 0;
    }

    .pill-list {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      margin-top: 4px;
    }

    .map-item {
      padding: 6px 8px;
      border-radius: 8px;
      background: #f2f2f7;
      margin-bottom: 4px;
      font-size: 13px;
    }

    .map-title {
      font-weight: 600;
    }

    .hidden {
      display: none;
    }

    @media (max-width: 768px) {
      .card {
        padding: 12px 14px;
      }
      h1 {
        font-size: 20px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>æŠ€æœ¯äº¤æµä¼š Â· æ¡Œæ¸¸å¼ç©æ³•æ¼”ç¤º Demo</h1>

    <!-- Step indicator -->
    <div class="card">
      <div class="steps">
        <span id="step-pill-1" class="step-pill active">1ï¸âƒ£ äº†è§£ç©æ³•</span>
        <span id="step-pill-2" class="step-pill">2ï¸âƒ£ åˆ†é…è§’è‰²ä¸æŠ€èƒ½</span>
        <span id="step-pill-3" class="step-pill">3ï¸âƒ£ å›åˆæµç¨‹æ¼”ç¤º</span>
        <span id="step-pill-4" class="step-pill">4ï¸âƒ£ æ€»ç»“ä¸è½åœ°</span>
      </div>
      <div id="global-guide" class="guide-box">
        <div class="guide-title">å½“å‰å¼•å¯¼</div>
        <div id="global-guide-text">
          æœ¬ Demo ç”¨æ¥å‘å‚ä¸è€…æ¼”ç¤ºæœ¬æ¬¡â€œæ¡Œæ¸¸å¼æŠ€æœ¯äº¤æµä¼šâ€çš„å®Œæ•´ç©æ³•ã€‚è¯·æŒ‰ä¸‹æ–¹æŒ‰é’®é€æ­¥ä½“éªŒæµç¨‹ã€‚
        </div>
      </div>
    </div>

    <!-- Section 1: Intro -->
    <div id="section-1" class="card">
      <div class="section-title">
        1ï¸âƒ£ ç©æ³•æ¦‚è§ˆ
        <span class="badge badge-primary">3 åˆ†é’Ÿå¯è®²æ¸…</span>
      </div>
      <p>æœ¬æ¬¡æŠ€æœ¯äº¤æµä¼šé‡‡ç”¨<strong>æ¡Œæ¸¸å¼æ”»é˜² + æŠ€èƒ½ç³»ç»Ÿ</strong>ï¼š</p>
      <ul>
        <li>æ‰€æœ‰äººå›´ç»•æŠ€æœ¯ä¸»é¢˜è¿›è¡Œè§‚ç‚¹æ”»é˜²ï¼Œä¸é—²èŠã€ä¸è·‘é¢˜ï¼›</li>
        <li>æ¯äººæœ‰ 3 å¼ â€œæŠ€èƒ½å¡â€ï¼Œåœ¨è®¨è®ºè¿‡ç¨‹ä¸­å¯éšæœºè§¦å‘ï¼Œå¢å¼ºè¶£å‘³æ€§ï¼›</li>
        <li>æ¯ä¸ªå›åˆæŒ‰ï¼š<strong>å‡ºé¢˜ â†’ åˆ†é˜µè¥ â†’ å‘è¨€ â†’ è§¦å‘æŠ€èƒ½ â†’ æŠ•ç¥¨ â†’ è®°å½•æŠ€æœ¯åœ°å›¾</strong> è¿›è¡Œï¼›</li>
        <li>ä¼šè®®ç»“æŸä¼šå½¢æˆä¸€å¼ â€œæŠ€æœ¯åœ°å›¾ç™½æ¿â€ï¼Œå¸®åŠ©æ‰€æœ‰äººè®°ä½è®¨è®ºç»“æœã€‚</li>
      </ul>

      <div class="guide-box">
        <div class="guide-title">ç°åœºè®²è§£è¯æœ¯ç¤ºä¾‹ï¼ˆå¯ç…§è¯»ï¼‰</div>
        <div style="font-size:13px;">
          ã€Œä»Šå¤©æˆ‘ä»¬ä¸ç”¨ä¼ ç»Ÿæ±‡æŠ¥çš„æ–¹å¼ï¼Œè€Œæ˜¯ç”¨ä¸€å¥—ç±»ä¼¼æ¡Œæ¸¸çš„äº¤æµå½¢å¼ã€‚<br>
          æ¯ä¸ªäººä¼šè¢«åˆ†é…è§’è‰²å’ŒæŠ€èƒ½ï¼Œæˆ‘ä»¬é€šè¿‡å‡ ä¸ªæ”»å‡»/é˜²å®ˆå›åˆï¼ŒæŠŠæŠ€æœ¯é—®é¢˜è®²æ¸…æ¥šã€è®²é€å½»ã€‚<br>
          ä½ åªè¦è·Ÿç€ç³»ç»Ÿå’Œä¸»æŒäººçš„æŒ‡å¼•èµ°ï¼Œå°±èƒ½å¾ˆå¿«ç†Ÿæ‚‰èŠ‚å¥ã€‚ã€</div>
      </div>

      <div class="btn-row">
        <button id="btn-go-step-2">ä¸‹ä¸€æ­¥ï¼šå¼€å§‹è¾“å…¥å‚ä¸è€… âœ</button>
      </div>
    </div>

    <!-- Section 2: Setup Participants -->
    <div id="section-2" class="card hidden">
      <div class="section-title">
        2ï¸âƒ£ åˆ†é…è§’è‰²ä¸æŠ€èƒ½
        <span class="badge badge-secondary">æ ¸å¿ƒ 3â€“5 äºº / å‚ä¸ 5â€“8 äºº</span>
      </div>

      <label for="names-input">è¯·è¾“å…¥å‚ä¸è€…å§“åï¼ˆç”¨ä¸­æ–‡é€—å·æˆ–è‹±æ–‡é€—å·åˆ†éš”ï¼‰ï¼Œä¾‹å¦‚ï¼šå¼ ä¸‰, æå››, ç‹äº”...</label>
      <textarea id="names-input" placeholder="ç¤ºä¾‹ï¼šå¼ ä¸‰, æå››, ç‹äº”, èµµå…­, å­™ä¸ƒ, å‘¨å…«, å´ä¹"></textarea>
      <div class="hint">å¦‚æœä¸è¾“å…¥ï¼Œåé¢å¯ä»¥ç”¨ç³»ç»Ÿé»˜è®¤çš„ã€Œç©å®¶1ã€ç©å®¶2...ã€æ¥æ¼”ç¤ºã€‚</div>

      <div style="display:flex; gap:12px; margin-top:8px; flex-wrap:wrap;">
        <div style="flex:1; min-width:150px;">
          <label for="core-count">æ ¸å¿ƒæ”»é˜²è€…äººæ•°ï¼ˆ3â€“5ï¼‰</label>
          <input id="core-count" type="number" min="3" max="5" value="3">
        </div>
        <div style="flex:1; min-width:150px;">
          <label for="main-count">ä¸»è¦å‚ä¸è€…äººæ•°ï¼ˆ5â€“8ï¼‰</label>
          <input id="main-count" type="number" min="5" max="8" value="5">
        </div>
      </div>

      <div class="btn-row" style="margin-top:10px;">
        <button id="btn-generate-roles">ç”Ÿæˆè§’è‰²ä¸æŠ€èƒ½</button>
        <button id="btn-use-demo-names" class="secondary">ä½¿ç”¨ç¤ºä¾‹åå•å¿«é€Ÿæ¼”ç¤º</button>
      </div>

      <div id="setup-result" class="hidden" style="margin-top:14px;">
        <h3 style="font-size:16px; margin-bottom:6px;">è§’è‰²ä¸æŠ€èƒ½åˆ†é…ç»“æœ</h3>
        <p style="font-size:13px; color:#666;">è¯·å¤§å®¶å¯¹å·å…¥åº§ï¼šç¡®è®¤è‡ªå·±æ˜¯ã€Œæ ¸å¿ƒã€ã€Œä¸»è¦å‚ä¸ã€è¿˜æ˜¯ã€Œæ—è§‚è¯„å®¡ã€ï¼Œå¹¶çœ‹ä¸€ä¸‹è‡ªå·±çš„ 3 ä¸ªæŠ€èƒ½ã€‚</p>
        <div style="overflow-x:auto;">
          <table>
            <thead>
              <tr>
                <th>å§“å</th>
                <th>è§’è‰²</th>
                <th>æŠ€èƒ½å¡ Ã—3</th>
              </tr>
            </thead>
            <tbody id="players-table-body"></tbody>
          </table>
        </div>

        <div class="guide-box">
          <div class="guide-title">ä¸»æŒäººæç¤ºï¼ˆç°åœºå¯ç…§è¯»ï¼‰</div>
          <div style="font-size:13px;">
            ã€Œè¯·å¤§å®¶åœ¨åå•é‡Œæ‰¾åˆ°è‡ªå·±çš„åå­—ï¼Œçœ‹ä¸€ä¸‹è‡ªå·±å±äºå“ªä¸€ç±»è§’è‰²ã€‚<br>
            æ¯ä¸ªäººæœ‰ 3 ä¸ªæŠ€èƒ½ï¼Œåœ¨åé¢çš„è®¨è®ºè¿‡ç¨‹ä¸­ï¼Œç³»ç»Ÿä¼šéšæœºè§¦å‘ï¼Œä½ å°±æ ¹æ®æç¤ºæ¥ä½¿ç”¨å¯¹åº”æŠ€èƒ½å³å¯ï¼Œä¸ç”¨ç°åœ¨è®°ä½æ‰€æœ‰ç»†èŠ‚ã€‚ã€</div>
        </div>

        <div class="btn-row">
          <button id="btn-go-step-3">ä¸‹ä¸€æ­¥ï¼šè¿›å…¥å›åˆæµç¨‹æ¼”ç¤º âœ</button>
        </div>
      </div>
    </div>

    <!-- Section 3: Round Simulation -->
    <div id="section-3" class="card hidden">
      <div class="section-title">
        3ï¸âƒ£ å›åˆæµç¨‹æ¼”ç¤º
        <span class="badge badge-primary">å‡ºé¢˜ â†’ åˆ†é˜µè¥ â†’ å‘è¨€ â†’ æŠ€èƒ½ â†’ æŠ•ç¥¨ â†’ åœ°å›¾</span>
      </div>

      <div style="display:flex; flex-wrap:wrap; gap:12px;">
        <div style="flex: 2 1 260px;">
          <div class="card" style="padding:10px 12px;">
            <div class="section-title" style="font-size:15px;">
              å½“å‰å›åˆ
              <span id="current-round-index" class="badge">ç¬¬ 1 å›åˆ</span>
            </div>
            <div style="font-size:13px; margin-bottom:6px;">
              <strong>ä¸»é¢˜ä»»åŠ¡å¡ï¼š</strong> <span id="current-topic-text"></span>
            </div>
            <div style="font-size:13px; margin-bottom:6px;">
              <strong>é˜µè¥ç¤ºä¾‹ï¼š</strong>è“æ–¹ï¼ˆæ”¯æŒï¼‰ã€çº¢æ–¹ï¼ˆåå¯¹ï¼‰ã€ä¸­ç«‹ï¼ˆæé—® / æŠ“å…³é”®ï¼‰ã€‚
            </div>
            <div style="font-size:13px;">
              <strong>å½“å‰æ­¥éª¤ï¼š</strong> <span id="current-phase-title"></span>
            </div>
            <div class="guide-box" style="margin-top:8px;">
              <div class="guide-title">æ¼”ç¤ºå¼•å¯¼</div>
              <div id="current-phase-desc" style="font-size:13px;"></div>
            </div>
            <div class="btn-row">
              <button id="btn-next-phase">ä¸‹ä¸€æ­¥ï¼ˆæ¼”ç¤ºä¸‹ä¸€ç¯èŠ‚ï¼‰ âœ</button>
              <button id="btn-trigger-skill" class="secondary">éšæœºè§¦å‘ä¸€ä¸ªæŠ€èƒ½ âœ¦</button>
            </div>
          </div>

          <div class="card" style="padding:10px 12px; margin-top:8px;">
            <div class="section-title" style="font-size:15px;">
              æŠ€èƒ½è§¦å‘æ—¥å¿—
              <span class="badge badge-secondary">æ¨¡æ‹Ÿæ•ˆæœ</span>
            </div>
            <div id="log-box" class="log-box"></div>
          </div>
        </div>

        <div style="flex: 1.4 1 240px;">
          <div class="card" style="padding:10px 12px;">
            <div class="section-title" style="font-size:15px;">
              æŠ€æœ¯åœ°å›¾ï¼ˆå›åˆç»“æœè®°å½•ï¼‰
              <span class="badge">å¯å¯¹åº”ç™½æ¿</span>
            </div>
            <div id="tech-map-list"></div>
            <div class="hint">å®é™…ä¼šè®®ä¸­ï¼Œè¿™éƒ¨åˆ†ä¼šå¯¹åº”å®ä½“ç™½æ¿/ä¾¿ç­¾ï¼Œæœ¬ Demo ç”¨å¡ç‰‡åˆ—è¡¨ä»£æ›¿ã€‚</div>
          </div>

          <div class="card" style="padding:10px 12px; margin-top:8px;">
            <div class="section-title" style="font-size:15px;">
              é˜¶æ®µå›é¡¾æç¤º
            </div>
            <div style="font-size:13px;">
              æ¯å®Œæˆä¸€ä¸ªå›åˆï¼Œä½ å¯ä»¥åœé¡¿ 10â€“20 ç§’ï¼Œå¯¹å¤§å®¶è¯´ï¼š
              <ul>
                <li>è¿™è½®ä¸»é¢˜æ˜¯ä»€ä¹ˆï¼Ÿ</li>
                <li>æ”¯æŒæ–¹/åå¯¹æ–¹åˆ†åˆ«å¼ºè°ƒäº†ä»€ä¹ˆï¼Ÿ</li>
                <li>å“ªä¸€ä¸ªè§‚ç‚¹è¢«å†™è¿›äº†æŠ€æœ¯åœ°å›¾ï¼Ÿ</li>
              </ul>
              è¿™æ ·èƒ½å¸®å¤§å®¶åœ¨è„‘å­é‡Œâ€œè¿‡ä¸€éâ€ï¼ŒåŠ æ·±è®°å¿†ã€‚
            </div>
          </div>
        </div>
      </div>

      <div class="btn-row" style="margin-top:10px;">
        <button id="btn-finish-sim" class="secondary">ç»“æŸæ¼”ç¤ºï¼ŒæŸ¥çœ‹æ€»ç»“ âœ</button>
      </div>
    </div>

    <!-- Section 4: Summary -->
    <div id="section-4" class="card hidden">
      <div class="section-title">
        4ï¸âƒ£ æ€»ç»“ä¸è½åœ°
        <span class="badge">è®©æ‰€æœ‰äººâ€œè®°ä½ç©æ³•â€</span>
      </div>
      <p>è‡³æ­¤ï¼Œæ•´ä¸ªâ€œæ¡Œæ¸¸å¼æŠ€æœ¯äº¤æµä¼šâ€çš„æµç¨‹å·²ç»æ¼”ç¤ºå®Œæ¯•ã€‚ä½ å¯ä»¥è®©å‚ä¸è€…å¤è¿°ï¼š</p>
      <ul>
        <li>ä½ åˆ†åˆ«æ‰®æ¼”äº†ä»€ä¹ˆè§’è‰²ï¼Ÿæ ¸å¿ƒ / å‚ä¸ / è§‚å¯Ÿï¼Ÿ</li>
        <li>ä½ æœ‰å“ªäº›æŠ€èƒ½ï¼Ÿå°è±¡æœ€æ·±çš„æ˜¯å“ªä¸ªæŠ€èƒ½ï¼Ÿ</li>
        <li>å›åˆæµç¨‹å¤§è‡´æ˜¯å“ªå‡ ä¸ªæ­¥éª¤ï¼Ÿ</li>
        <li>æŠ€æœ¯åœ°å›¾ä¸Šçš„å‡ ä¸ªå…³é”®ç»“è®ºæ˜¯ä»€ä¹ˆï¼Ÿ</li>
      </ul>
      <div class="guide-box">
        <div class="guide-title">ä¸»æŒäººç°åœºæ”¶å°¾è¯æœ¯ç¤ºä¾‹</div>
        <div style="font-size:13px;">
          ã€Œåˆšæ‰æˆ‘ä»¬å®Œæ•´èµ°äº†ä¸€éè§„åˆ™æ¼”ç¤ºï¼ŒçœŸå®ä¼šè®®æ—¶ï¼Œå°±æ˜¯ç”¨åŒæ ·çš„èŠ‚å¥ï¼Œåªæ˜¯æŠŠä¸»é¢˜æ¢æˆæˆ‘ä»¬ä»Šå¤©çœŸæ­£è¦è®¨è®ºçš„é—®é¢˜ã€‚<br>
          å›åˆæ•°å¯ä»¥æ ¹æ®æ—¶é—´è°ƒæ•´ï¼Œä½†ä¸å˜çš„æ˜¯ï¼š<strong>æ¯è½®éƒ½æœ‰æ˜ç¡®çš„ä¸»é¢˜ã€æœ‰æ”»æœ‰å®ˆã€æœ‰æŠ€èƒ½å¸¦æ¥çš„å˜åŒ–ï¼Œæœ€åéƒ½ä¼šæ²‰æ·€åœ¨æŠ€æœ¯åœ°å›¾é‡Œã€‚</strong>ã€</div>
      </div>

      <div class="btn-row">
        <button id="btn-restart" class="secondary">é‡æ–°æ¼”ç¤ºä¸€é ğŸ”</button>
      </div>
    </div>
  </div>

  <script>
    // ===== å·¥å…·å‡½æ•° =====
    function $(id) {
      return document.getElementById(id);
    }

    function shuffle(array) {
      const arr = array.slice();
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    function randomChoice(arr) {
      if (!arr.length) return null;
      const idx = Math.floor(Math.random() * arr.length);
      return arr[idx];
    }

    function appendLog(text) {
      const box = $("log-box");
      const entry = document.createElement("div");
      entry.className = "log-entry";
      const time = new Date().toLocaleTimeString("zh-CN", { hour12: false });
      entry.textContent = "[" + time + "] " + text;
      box.appendChild(entry);
      box.scrollTop = box.scrollHeight;
    }

    // ===== å…¨å±€çŠ¶æ€ =====
    let players = []; // {name, role, skills:[{type,name,desc}]}
    let rounds = [];
    let currentRoundIndex = 0;
    let currentPhaseIndex = 0;

    const phases = [
      {
        title: "â‘  æŠ½å–ä¸»é¢˜ä»»åŠ¡å¡",
        desc: "ä¸»æŒäººä»é¢„å…ˆå‡†å¤‡å¥½çš„æŠ€æœ¯è®®é¢˜ä¸­æŠ½å–ä¸€ä¸ªï¼Œå‘å¤§å®¶å®£è¯»ã€‚æ‰€æœ‰äººå…ˆèŠ±å‡ ç§’åœ¨è„‘å­é‡Œè¿‡ä¸€éï¼šè¿™ä¸ªé—®é¢˜å¯¹æˆ‘ä»¬æœ‰ä»€ä¹ˆæ„ä¹‰ï¼Ÿ"
      },
      {
        title: "â‘¡ åˆ’åˆ†é˜µè¥ï¼ˆæ”¯æŒ / åå¯¹ / ä¸­ç«‹ï¼‰",
        desc: "æ ¸å¿ƒæ”»é˜²è€…è‡ªåŠ¨åˆ†æˆè“æ–¹ï¼ˆæ”¯æŒï¼‰ä¸çº¢æ–¹ï¼ˆåå¯¹ï¼‰ï¼Œä¸­ç«‹è§’è‰²è´Ÿè´£æé—®å’ŒæŠ“é‡ç‚¹ã€‚ä½ å¯ä»¥ç°åœºæŒ‡å®šæˆ–ç”±ç³»ç»Ÿéšæœºåˆ†é…ã€‚"
      },
      {
        title: "â‘¢ ä¾æ¬¡å‘è¨€ï¼ˆæ¯äºº 1 åˆ†é’Ÿï¼‰",
        desc: "è½®åˆ°ä½ å‘è¨€æ—¶ï¼Œå…ˆé€‰æ‹©ä¸€å¼ è§‚ç‚¹å¡ï¼ˆæ”¯æŒ/åå¯¹/è¡¥å……ï¼‰ï¼Œç„¶åç”¨ 1 åˆ†é’Ÿæ—¶é—´è®²è¿°ä½ çš„è¦ç‚¹ã€‚æ—¶é—´åˆ°äº†å¿…é¡»ç»“æŸï¼Œé¿å…è·‘é¢˜ã€‚"
      },
      {
        title: "â‘£ è§¦å‘æŠ€èƒ½äº‹ä»¶ï¼ˆå¢åŠ è¶£å‘³æ€§ï¼‰",
        desc: "ä¸»æŒäººæˆ–ç³»ç»Ÿéšæœºç‚¹åä¸€ä½ç©å®¶ï¼Œè¦æ±‚ä»–ä½¿ç”¨ä¸€å¼ æŠ€èƒ½å¡ã€‚ä¾‹å¦‚â€œæ²‰é»˜ä¹‹åˆƒâ€â€œæ—¶é—´èµç¦â€â€œå¡ç‰‡äº¤æ¢â€ç­‰ï¼Œå¼•å¯¼äº¤é”‹æ›´æœ‰è¶£ã€‚"
      },
      {
        title: "â‘¤ å¤§ä¼—è¯„å®¡å›¢æŠ•ç¥¨ï¼ˆè´´çº¸ / ç­¹ç ï¼‰",
        desc: "æ—è§‚ä¸è¾…åŠ©å‚ä¸è€…ä½œä¸ºâ€œå¤§ä¼—è¯„å®¡â€ï¼Œä¸ºä»–ä»¬è®¤ä¸ºæœ¬è½®æœ€æœ‰ä»·å€¼çš„è§‚ç‚¹æŠ•ç¥¨ã€‚ç¥¨æ•°æœ€é«˜çš„è§‚ç‚¹ï¼Œå°†è¢«å†™å…¥æŠ€æœ¯åœ°å›¾ã€‚"
      },
      {
        title: "â‘¥ è®°å½•åˆ°æŠ€æœ¯åœ°å›¾ï¼ˆç™½æ¿ï¼‰",
        desc: "ä¸»æŒäººåœ¨ç™½æ¿ä¸Šï¼Œç”¨ä¸€å¥è¯è®°å½•æœ¬è½®æŠ•ç¥¨èƒœå‡ºçš„è§‚ç‚¹ä»¥åŠå¯¹åº”çš„è§£å†³æ€è·¯ã€‚å›åˆç»“æŸï¼Œè¿›å…¥ä¸‹ä¸€è½®ã€‚"
      }
    ];

    const sampleTopics = [
      "æ˜¯å¦åº”è¯¥åœ¨ç°æœ‰ä¸šåŠ¡ç³»ç»Ÿä¸­å…¨é¢å¼•å…¥å¤§æ¨¡å‹èƒ½åŠ›ï¼Ÿ",
      "æˆ‘ä»¬çš„æ•°æ®å¹³å°ï¼Œä¸‹ä¸€å¹´åº¦ä¼˜å…ˆä¼˜åŒ–çš„æ˜¯â€œæ€§èƒ½â€è¿˜æ˜¯â€œæ˜“ç”¨æ€§â€ï¼Ÿ",
      "åœ¨å½“å‰é˜¶æ®µï¼Œå¾®æœåŠ¡æ‹†åˆ†æ˜¯å¦å·²ç»è¿‡åº¦ï¼Ÿè¦ä¸è¦é€‚åº¦å›å½’å•ä½“/æ¨¡å—åŒ–ï¼Ÿ"
    ];

    const sampleMapSummaries = [
      "åœ¨å®‰å…¨å’Œæˆæœ¬å¯æ§çš„å‰æä¸‹ï¼Œå°èŒƒå›´è¯•ç‚¹å¤§æ¨¡å‹ï¼Œä¼˜å…ˆæ”¹é€ å†…éƒ¨å¼€å‘/è¿ç»´å·¥å…·ã€‚",
      "å…ˆè§£å†³å¯è§‚æµ‹æ€§å’Œæ˜“ç”¨æ€§ï¼Œå†åœ¨å…³é”®é“¾è·¯ä¸Šé’ˆå¯¹æ€§åšæ€§èƒ½ä¼˜åŒ–ã€‚",
      "ç¦æ­¢â€œä¸ºæ‹†è€Œæ‹†â€ï¼ŒæŒ‰ç…§ä¸šåŠ¡è¾¹ç•Œå’Œå›¢é˜Ÿèƒ½åŠ›é‡æ–°æ¢³ç†æœåŠ¡é¢—ç²’åº¦ã€‚"
    ];

    const skillPool = {
      attack: [
        {
          name: "æ²‰é»˜ä¹‹åˆƒ",
          desc: "ä¸­æ–­å½“å‰å‘è¨€è€…çš„å‰©ä½™æ—¶é—´ï¼Œå¼ºåˆ¶ç»“æŸæœ¬è½®å‘è¨€ã€‚"
        },
        {
          name: "ç‚¹ç ´ç›²åŒº",
          desc: "è¦æ±‚å‘è¨€äººå¿…é¡»å›ç­”ä¸€ä¸ªé£é™©é—®é¢˜ï¼Œå¦åˆ™æœ¬è½®å¤±å»æŠ•ç¥¨èµ„æ ¼ã€‚"
        },
        {
          name: "è§‚ç‚¹åè½¬",
          desc: "å¼ºåˆ¶æŸä½ç©å®¶ä»åæ–¹å‘è§’åº¦ç»§ç»­é˜è¿°ä»–çš„è§‚ç‚¹ã€‚"
        }
      ],
      support: [
        {
          name: "æ—¶é—´èµç¦",
          desc: "ä¸ºæŸä½å‘è¨€è€…å¢åŠ  30 ç§’å‘è¨€æ—¶é—´ã€‚"
        },
        {
          name: "åä½œå…±é¸£",
          desc: "å¼ºåˆ¶æŒ‡å®šä¸€äººåŠ å…¥ä½ çš„é˜µè¥ï¼ˆæ”¯æŒ/åå¯¹ï¼‰ã€‚"
        },
        {
          name: "è§‚ç‚¹æ•´ç†è€…",
          desc: "è¦æ±‚ä¸»æŒäººç«‹å³åœ¨ç™½æ¿ä¸Šæ€»ç»“å½“å‰è®¨è®ºçš„å…³é”®è¦ç‚¹ã€‚"
        }
      ],
      chaos: [
        {
          name: "å¡ç‰‡äº¤æ¢",
          desc: "éšæœºä¸ä¸€ä½ç©å®¶äº¤æ¢è§‚ç‚¹å¡ï¼Œä½¿å…¶ç«‹åœºå‘ç”Ÿå˜åŒ–ã€‚"
        },
        {
          name: "å¬å”¤æ—è§‚è€…",
          desc: "éšæœºä»è§‚å¯Ÿè€…ä¸­æ‹‰ä¸€ä½åŠ å…¥æœ¬è½®å‘è¨€ã€‚"
        },
        {
          name: "ä¸»é¢˜é‡æŠ•",
          desc: "å‘åŠ¨ä¸€æ¬¡ï¼Œè¦æ±‚æœ¬è½®æŠ•ç¥¨é‡æ–°è¿›è¡Œã€‚"
        }
      ]
    };

    function createDemoNames() {
      return ["å¼ ä¸‰", "æå››", "ç‹äº”", "èµµå…­", "å­™ä¸ƒ", "å‘¨å…«", "å´ä¹", "éƒ‘å", "å°åˆ˜", "å°é™ˆ", "å°é»„", "å°å‘¨"];
    }

    function generatePlayers(names, coreCount, mainCount) {
      const maxTotal = 20;
      let list = names && names.length ? names : createDemoNames();
      if (list.length > maxTotal) {
        list = list.slice(0, maxTotal);
      }
      // å¦‚æœäººæ•°ä¸è¶³ï¼Œè‡ªåŠ¨è¡¥é½è™šæ‹Ÿç©å®¶
      while (list.length < coreCount + mainCount + 1) {
        list.push("ç©å®¶" + (list.length + 1));
      }
      const shuffled = shuffle(list);
      const playersData = [];
      shuffled.forEach((name, index) => {
        let role;
        if (index < coreCount) role = "core";
        else if (index < coreCount + mainCount) role = "main";
        else role = "observer";

        const skills = [];
        for (let i = 0; i < 3; i++) {
          const typeKey = randomChoice(["attack", "support", "chaos"]);
          const pool = skillPool[typeKey];
          skills.push({ type: typeKey, ...randomChoice(pool) });
        }

        playersData.push({ name, role, skills });
      });
      return playersData;
    }

    function renderPlayersTable() {
      const tbody = $("players-table-body");
      tbody.innerHTML = "";
      players.forEach(p => {
        const tr = document.createElement("tr");
        const roleMap = {
          core: { text: "æ ¸å¿ƒæ”»é˜²è€…", cls: "role-core" },
          main: { text: "ä¸»è¦å‚ä¸è€…", cls: "role-main" },
          observer: { text: "è§‚å¯Ÿ/è¯„å®¡", cls: "role-observer" }
        };
        const roleInfo = roleMap[p.role];

        const tdName = document.createElement("td");
        tdName.textContent = p.name;

        const tdRole = document.createElement("td");
        const spanRole = document.createElement("span");
        spanRole.className = "role-tag " + roleInfo.cls;
        spanRole.textContent = roleInfo.text;
        tdRole.appendChild(spanRole);

        const tdSkills = document.createElement("td");
        p.skills.forEach(s => {
          const spanSkill = document.createElement("span");
          let cls = "skill-tag ";
          if (s.type === "attack") cls += "skill-attack";
          else if (s.type === "support") cls += "skill-support";
          else cls += "skill-chaos";
          spanSkill.className = cls;
          spanSkill.textContent = s.name;
          spanSkill.title = s.desc;
          tdSkills.appendChild(spanSkill);
        });

        tr.appendChild(tdName);
        tr.appendChild(tdRole);
        tr.appendChild(tdSkills);
        tbody.appendChild(tr);
      });
    }

    function initRounds() {
      rounds = sampleTopics.map((topic, idx) => ({
        topic,
        summary: sampleMapSummaries[idx] || "æœ¬è½®çš„å…³é”®è§‚ç‚¹å°†å†™åœ¨è¿™é‡Œã€‚",
        done: false
      }));
      currentRoundIndex = 0;
      currentPhaseIndex = 0;
    }

    function updateStepPills(active) {
      for (let i = 1; i <= 4; i++) {
        const pill = $("step-pill-" + i);
        if (i === active) pill.classList.add("active");
        else pill.classList.remove("active");
      }
    }

    function showSection(index) {
      ["section-1", "section-2", "section-3", "section-4"].forEach((id, i) => {
        $(id).classList.toggle("hidden", i !== index - 1);
      });
      updateStepPills(index);
      const guideText = $("global-guide-text");
      if (index === 1) {
        guideText.textContent = "å…ˆå‘å¤§å®¶ä»‹ç»æ•´ä¸ªäº¤æµä¼šçš„ç©æ³•å’Œç›®æ ‡ï¼Œè®©æ‰€æœ‰äººçŸ¥é“ï¼šè¿™ä¸ªä¼šè®®æ—¢ä¸¥è‚ƒåˆå¥½ç©ã€‚";
      } else if (index === 2) {
        guideText.textContent = "ç°åœ¨è¯·å¤§å®¶è¾“å…¥æˆ–ç¡®è®¤å‚ä¸è€…åå•ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨åˆ†é…è§’è‰²å’ŒæŠ€èƒ½ï¼Œè®©æ¯ä¸ªäººå¯¹å·å…¥åº§ã€‚";
      } else if (index === 3) {
        guideText.textContent = "ä¸‹é¢æˆ‘ä»¬é€šè¿‡ 2â€“3 ä¸ªç¤ºä¾‹å›åˆï¼Œæ¼”ç¤ºæ•´ä¸ªä¼šè®®çš„æµç¨‹ã€‚ä½ åªéœ€è¦æƒ³è±¡ï¼šå¦‚æœæ˜¯çœŸå®ä¼šè®®ï¼Œåˆšåˆšè¿™äº›åŠ¨ä½œå°±ä¼šå‘ç”Ÿåœ¨ä½ ä»¬å‘¨å›´ã€‚";
      } else if (index === 4) {
        guideText.textContent = "æœ€åï¼Œå¯¹æ•´ä¸ªæ¡Œæ¸¸å¼ä¼šè®®åšä¸€ä¸ªæ€»ç»“ï¼Œå¹¶è¯´æ˜çœŸå®ä¼šè®®è½åœ°æ—¶ä»…éœ€è¦æ›¿æ¢å…·ä½“æŠ€æœ¯ä¸»é¢˜ã€‚";
      }
    }

    function loadCurrentRound() {
      const round = rounds[currentRoundIndex];
      $("current-round-index").textContent = "ç¬¬ " + (currentRoundIndex + 1) + " å›åˆ";
      $("current-topic-text").textContent = round.topic;
      currentPhaseIndex = 0;
      updatePhaseUI();
    }

    function updatePhaseUI() {
      const phase = phases[currentPhaseIndex];
      $("current-phase-title").textContent = phase.title;
      $("current-phase-desc").textContent = phase.desc;

      // å½“å‰æ­¥éª¤é«˜äº®ä¸€ä¸‹ card æ•ˆæœï¼ˆç®€å•ï¼šåˆ‡æ¢ highlightï¼‰
      const card = $("section-3");
      if (card) {
        card.classList.add("highlight");
        setTimeout(() => card.classList.remove("highlight"), 300);
      }
    }

    function goToNextPhase() {
      if (!rounds.length) return;
      if (currentPhaseIndex < phases.length - 1) {
        currentPhaseIndex++;
        updatePhaseUI();
      } else {
        // å½“å‰å›åˆç»“æŸï¼Œå†™å…¥æŠ€æœ¯åœ°å›¾
        const round = rounds[currentRoundIndex];
        if (!round.done) {
          round.done = true;
          const mapList = $("tech-map-list");
          const div = document.createElement("div");
          div.className = "map-item";
          const title = document.createElement("div");
          title.className = "map-title";
          title.textContent = "ç¬¬ " + (currentRoundIndex + 1) + " å›åˆï¼š" + round.topic;
          const content = document.createElement("div");
          content.style.fontSize = "13px";
          content.textContent = "å…±è¯†ç»“è®ºï¼š" + round.summary;
          div.appendChild(title);
          div.appendChild(content);
          mapList.appendChild(div);
        }

        // åˆ‡æ¢åˆ°ä¸‹ä¸€å›åˆæˆ–ç»“æŸ
        if (currentRoundIndex < rounds.length - 1) {
          currentRoundIndex++;
          loadCurrentRound();
          appendLog("âœ… å·²ç»“æŸä¸Šä¸€å›åˆï¼Œè‡ªåŠ¨è¿›å…¥ä¸‹ä¸€å›åˆæ¼”ç¤ºã€‚");
        } else {
          appendLog("ğŸ‰ æ‰€æœ‰æ¼”ç¤ºå›åˆå·²ç»“æŸï¼Œå¯ä»¥ç‚¹å‡»â€œç»“æŸæ¼”ç¤ºâ€è¿›å…¥æ€»ç»“ã€‚");
          alert("ç¤ºä¾‹çš„ 3 ä¸ªå›åˆå·²ç»æ¼”ç¤ºå®Œæ¯•ï¼Œä½ å¯ä»¥ç‚¹å‡»ä¸‹æ–¹â€œç»“æŸæ¼”ç¤ºï¼ŒæŸ¥çœ‹æ€»ç»“â€ã€‚");
        }
      }
    }

    function triggerRandomSkill() {
      if (!players.length) {
        alert("è¯·å…ˆå®Œæˆè§’è‰²å’ŒæŠ€èƒ½åˆ†é…ã€‚");
        return;
      }
      const player = randomChoice(players);
      const skill = randomChoice(player.skills);
      const roleText = player.role === "core" ? "æ ¸å¿ƒæ”»é˜²è€…"
                    : player.role === "main" ? "ä¸»è¦å‚ä¸è€…"
                    : "è§‚å¯Ÿ/è¯„å®¡";

      const typeLabel =
        skill.type === "attack" ? "ã€æ”»å‡»ç±»ã€‘" :
        skill.type === "support" ? "ã€è¾…åŠ©ç±»ã€‘" :
        "ã€å˜æ•°ç±»ã€‘";

      const text = `${player.name}ï¼ˆ${roleText}ï¼‰è§¦å‘äº† ${typeLabel}æŠ€èƒ½ã€Œ${skill.name}ã€ï¼š${skill.desc}`;
      appendLog(text);
    }

    // ===== äº‹ä»¶ç»‘å®š =====
    window.addEventListener("DOMContentLoaded", () => {
      // Step navigation
      $("btn-go-step-2").addEventListener("click", () => showSection(2));

      $("btn-use-demo-names").addEventListener("click", () => {
        $("names-input").value = createDemoNames().join(", ");
      });

      $("btn-generate-roles").addEventListener("click", () => {
        let namesText = $("names-input").value.trim();
        let names = [];
        if (namesText) {
          names = namesText.split(/[,ï¼Œ]/).map(s => s.trim()).filter(Boolean);
        }
        let coreCount = parseInt($("core-count").value, 10) || 3;
        let mainCount = parseInt($("main-count").value, 10) || 5;
        if (coreCount < 3) coreCount = 3;
        if (coreCount > 5) coreCount = 5;
        if (mainCount < 5) mainCount = 5;
        if (mainCount > 8) mainCount = 8;

        players = generatePlayers(names, coreCount, mainCount);
        renderPlayersTable();
        $("setup-result").classList.remove("hidden");
      });

      $("btn-go-step-3").addEventListener("click", () => {
        if (!players.length) {
          alert("è¯·å…ˆå®Œæˆè§’è‰²ä¸æŠ€èƒ½åˆ†é…ã€‚");
          return;
        }
        showSection(3);
        $("log-box").innerHTML = "";
        $("tech-map-list").innerHTML = "";
        initRounds();
        loadCurrentRound();
        appendLog("ğŸš€ å›åˆæ¼”ç¤ºå¼€å§‹ã€‚è¯·æŒ‰ç…§å¼•å¯¼ï¼Œé€æ­¥æƒ³è±¡çœŸå®ä¼šè®®ä¸­çš„æ¯ä¸€æ­¥åŠ¨ä½œã€‚");
      });

      $("btn-next-phase").addEventListener("click", () => {
        goToNextPhase();
      });

      $("btn-trigger-skill").addEventListener("click", () => {
        triggerRandomSkill();
      });

      $("btn-finish-sim").addEventListener("click", () => {
        showSection(4);
      });

      $("btn-restart").addEventListener("click", () => {
        // é‡ç½®çŠ¶æ€ï¼Œå›åˆ°ç¬¬ 2 æ­¥ï¼ˆä¿ç•™åå•ï¼Œä½†æ¸…ç©ºåœ°å›¾ä¸æ—¥å¿—ï¼‰
        $("log-box").innerHTML = "";
        $("tech-map-list").innerHTML = "";
        rounds = [];
        currentRoundIndex = 0;
        currentPhaseIndex = 0;
        showSection(2);
      });
    });
  </script>
</body>
</html>
